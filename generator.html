<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Valentine Link Generator</title>
  <meta name="description" content="Generate your Valentine link">
  <link rel="icon" type="image/png" href="img/favicon.png">

  <!-- Open Graph -->
  <meta property="og:url" content="https://dayanch96.github.io/valentine/generator.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Generate your Valentine link">
  <meta property="og:image" content="https://raw.githubusercontent.com/dayanch96/valentine/refs/heads/main/img/header.png">
  <meta property="og:description" content="Valentine Link Generator">
  <meta property="og:site_name" content="Valentine Link Generator">
  <meta property="og:image:alt" content="Valentine Link Generator">

  <!-- Twitter Meta Tags -->
  <meta property="twitter:url" content="generator.html">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Generate your Valentine link">
  <meta name="twitter:description" content="Valentine Link Generator">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/dayanch96/valentine/refs/heads/main/img/header.png">

  <style>
    :root {
      --bg1: #ffd6e7;
      --bg2: #ffeef6;
      --card: #ffffffcc;
      --primary: #ff3b7a;
      --primaryHover: #ff1f68;
      --text: #111827;
      --muted: rgba(17,24,39,.7);
      --border: rgba(17,24,39,.12);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      font-family: system-ui, -apple-system, sans-serif;
      padding: 16px;
      color: var(--text);
    }

    .card {
      width: min(720px, 92vw);
      padding: 26px 22px;
      background: var(--card);
      backdrop-filter: blur(10px);
      border-radius: 22px;
      text-align: center;
      box-shadow: 0 18px 60px rgba(0,0,0,.15);
    }

    h1 {
      font-size: clamp(22px, 4vw, 36px);
      margin: 0 0 10px;
    }

    p {
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.35;
    }

    .grid {
      display: grid;
      gap: 12px;
      width: min(520px, 100%);
      margin: 0 auto;
      text-align: left;
    }

    label {
      font-size: 13px;
      color: rgba(17,24,39,.75);
      font-weight: 700;
      margin-bottom: 6px;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.75);
      font-size: 16px;
      outline: none;
    }

    input:focus, select:focus {
      border-color: rgba(255,59,122,.35);
      box-shadow: 0 0 0 4px rgba(255,59,122,.12);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 620px) {
      .row {
        grid-template-columns: 1.2fr 0.8fr;
      }
    }

    .btn {
      width: 100%;
      padding: 14px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 800;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
      transition: transform .12s ease, background .12s ease, opacity .12s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active { transform: scale(.98); }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }
    .btn-primary:hover { background: var(--primaryHover); }

    .output {
      margin-top: 16px;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.65);
      text-align: left;
      word-break: break-all;
      font-size: 14px;
      line-height: 1.35;
    }

    .actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }

    .tiny {
      margin-top: 10px;
      font-size: 12px;
      color: rgba(17,24,39,.55);
    }

    .error {
      margin-top: 12px;
      color: #b91c1c;
      font-weight: 700;
      font-size: 13px;
      display: none;
      text-align: center;
    }
  </style>
</head>

<body>
  <main class="card">
    <h1>Link Generator</h1>
    <p>Enter a name, choose a language, generate a link and send it</p>

    <div class="grid">
      <div class="row">
        <div>
          <label for="nameInput">Name (optional)</label>
          <input id="nameInput" placeholder="Dan" />
        </div>

        <div>
          <label for="langSelect">Language</label>
          <select id="langSelect"></select>
        </div>
      </div>

      <div class="output" id="output">Your link will appear here</div>
      <div class="actions">
        <button class="btn btn-primary" id="copyBtn">Copy</button>
        <button class="btn btn-primary" id="openBtn">Open</button>
      </div>

      <div class="error" id="error"></div>
    </div>
  </main>

  <script>
    const REPO_OWNER = "ironnixx";
    const REPO_NAME = "valentine";
    const LANG_FOLDER = "lang";
    const VALENTINE_PAGE = "valentine.html";

    const nameInput = document.getElementById("nameInput");
    const langSelect = document.getElementById("langSelect");
    const output = document.getElementById("output");
    const errorEl = document.getElementById("error");
    const copyBtn = document.getElementById("copyBtn");
    const openBtn = document.getElementById("openBtn");

    function showError(msg) {
      errorEl.textContent = msg;
      errorEl.style.display = msg ? "block" : "none";
    }

    function safeLangName(code) {
      try {
        const dn = new Intl.DisplayNames(["en"], { type: "language" });
        const base = code.split("-")[0];
        const name = dn.of(base);
        if (!name) return code;
        return code.includes("-") ? `${name} (${code})` : `${name} (${code})`;
      } catch (e) {
        return code;
      }
    }

    async function loadLangFilesFromGitHub() {
      const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${LANG_FOLDER}`;
      const res = await fetch(apiUrl, { cache: "no-store" });
      if (!res.ok) throw new Error("Failed to load languages from GitHub API");

      const data = await res.json();

      const codes = data
        .filter(x => x.type === "file" && x.name.endsWith(".json"))
        .map(x => x.name.replace(".json", ""))
        .filter(code => code && code !== "index");

      codes.sort((a, b) => {
        if (a === "en") return -1;
        if (b === "en") return 1;
        return a.localeCompare(b);
      });

      return codes;
    }

    function buildLink(name, lang) {
      const baseUrl = new URL(VALENTINE_PAGE, window.location.href);

      if (name && name.trim().length > 0) {
        baseUrl.searchParams.set("name", name.trim());
      } else {
        baseUrl.searchParams.delete("name");
      }

      baseUrl.searchParams.set("lang", lang);

      return baseUrl.toString();
    }

    async function init() {
      try {
        showError("");

        const codes = await loadLangFilesFromGitHub();

        langSelect.innerHTML = "";
        for (const code of codes) {
          const opt = document.createElement("option");
          opt.value = code;
          opt.textContent = safeLangName(code);
          langSelect.appendChild(opt);
        }

        const browser = (navigator.language || "en").split("-")[0];
        const hasBrowser = codes.includes(browser);
        langSelect.value = hasBrowser ? browser : (codes.includes("en") ? "en" : codes[0]);
        output.textContent = buildLink(nameInput.value, langSelect.value);
      } catch (e) {
        showError("Could not load languages. GitHub API blocked or repo name is wrong.");
        langSelect.innerHTML = `<option value="en">English (en)</option>`;
      }
    }

    copyBtn.addEventListener("click", async () => {
      const text = output.textContent || "";
      if (!text.startsWith("http")) return;

      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy", 900);
      } catch (e) {
        const tmp = document.createElement("textarea");
        tmp.value = text;
        document.body.appendChild(tmp);
        tmp.select();
        document.execCommand("copy");
        document.body.removeChild(tmp);
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy", 900);
      }
    });

    openBtn.addEventListener("click", () => {
      const text = output.textContent || "";
      if (!text.startsWith("http")) return;
      window.open(text, "_blank");
    });

    nameInput.addEventListener("input", () => {
      output.textContent = buildLink(nameInput.value, langSelect.value);
    });
    langSelect.addEventListener("change", () => {
      output.textContent = buildLink(nameInput.value, langSelect.value);
    });

    init();
  </script>
</body>
</html>
